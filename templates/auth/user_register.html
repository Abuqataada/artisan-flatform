{% extends "base.html" %}

{% block title %}Register as Client - Uwaila Global{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card border-0 shadow-sm">
            <div class="card-body p-5">
                <div class="text-center mb-4">
                    <i class="fas fa-user-plus fa-3x text-primary mb-3"></i>
                    <h2 class="card-title">Create Client Account</h2>
                    <p class="text-muted">Register to request services from verified artisans</p>
                </div>
                
                <form method="POST" action="{{ url_for('user_bp.register') }}">
                    {{ form.hidden_tag() if form }}
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="full_name" class="form-label">Full Name *</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                                <input type="text" class="form-control" id="full_name" name="full_name" 
                                       placeholder="Enter your full name" required>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="phone" class="form-label">Phone Number *</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                <input type="tel" class="form-control" id="phone" name="phone" 
                                       placeholder="09012345678" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="email" class="form-label">Email Address *</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                            <input type="email" class="form-control" id="email" name="email" 
                                   placeholder="Enter your email" required>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="nin" class="form-label">NIN *</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-id-card"></i></span>
                            <input type="text" class="form-control" id="nin" name="nin" 
                                placeholder="Enter your NIN (11 digits)" 
                                pattern="\d{11}" 
                                title="NIN must be exactly 11 numeric digits"
                                maxlength="11"
                                required>
                        </div>
                        <div class="form-text">NIN must be exactly 11 numeric digits</div>
                        <div id="nin-error" class="text-danger small mt-1" style="display: none;"></div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="address" class="form-label">Address</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-home"></i></span>
                            <textarea class="form-control" id="address" name="address" 
                                     rows="2" placeholder="Enter your address"></textarea>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="password" class="form-label">Password *</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                <input type="password" class="form-control" id="password" name="password" 
                                       placeholder="Create password" required>
                            </div>
                            <div class="form-text">At least 8 characters</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="confirm_password" class="form-label">Confirm Password *</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                <input type="password" class="form-control" id="confirm_password" name="confirm_password" 
                                       placeholder="Confirm password" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="terms" name="terms" required>
                        <label class="form-check-label" for="terms">
                            I agree to the <a href="#" class="text-decoration-none">Terms of Service</a> and 
                            <a href="#" class="text-decoration-none">Privacy Policy</a>
                        </label>
                    </div>
                    
                    <div class="d-grid mb-3">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-user-plus me-2"></i>Create Account
                        </button>
                    </div>
                    
                    <div class="text-center">
                        <p class="mb-0">Already have an account? 
                            <a href="{{ url_for('user_bp.login') }}" class="text-decoration-none">Sign In</a>
                        </p>
                        <p class="mt-2">
                            Want to offer services? 
                            <a href="{{ url_for('artisan_bp.register') }}" class="text-decoration-none">
                                Register as Artisan
                            </a>
                        </p>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<style>
    .is-valid {
        border-color: #198754 !important;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e") !important;
        background-repeat: no-repeat;
        background-position: right calc(.375em + .1875rem) center;
        background-size: calc(.75em + .375rem) calc(.75em + .375rem);
    }

    .is-invalid {
        border-color: #dc3545 !important;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e") !important;
        background-repeat: no-repeat;
        background-position: right calc(.375em + .1875rem) center;
        background-size: calc(.75em + .375rem) calc(.75em + .375rem);
    }
</style>

{% block scripts %}
<script>
    // Password confirmation validation
    document.querySelector('form').addEventListener('submit', function(e) {
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm_password').value;
        const ninInput = document.getElementById('nin');
        const ninError = document.getElementById('nin-error');
        const nin = ninInput.value;
        
        // Reset error display
        ninError.style.display = 'none';
        ninInput.classList.remove('is-invalid');
        
        // Validate NIN
        if (!/^\d{11}$/.test(nin)) {
            e.preventDefault();
            ninInput.classList.add('is-invalid');
            ninError.textContent = 'NIN must be exactly 11 numeric digits';
            ninError.style.display = 'block';
            return false;
        }
        
        // Password validation
        if (password !== confirmPassword) {
            e.preventDefault();
            alert('Passwords do not match!');
            return false;
        }
        
        if (password.length < 8) {
            e.preventDefault();
            alert('Password must be at least 8 characters long!');
            return false;
        }
    });
    
    // Real-time NIN validation as user types
    document.getElementById('nin').addEventListener('input', function(e) {
        const ninInput = e.target;
        const ninError = document.getElementById('nin-error');
        const value = ninInput.value;
        
        // Remove any non-digit characters
        const sanitized = value.replace(/\D/g, '');
        
        // Update the input value with only digits
        if (value !== sanitized) {
            ninInput.value = sanitized;
        }
        
        // Limit to 11 digits
        if (sanitized.length > 11) {
            ninInput.value = sanitized.substring(0, 11);
        }
        
        // Show/hide error message
        if (sanitized.length > 0 && sanitized.length !== 11) {
            ninInput.classList.add('is-invalid');
            ninError.textContent = `NIN must be exactly 11 digits (currently ${sanitized.length})`;
            ninError.style.display = 'block';
        } else if (sanitized.length === 11) {
            ninInput.classList.remove('is-invalid');
            ninInput.classList.add('is-valid');
            ninError.style.display = 'none';
        } else {
            ninInput.classList.remove('is-invalid', 'is-valid');
            ninError.style.display = 'none';
        }
    });
</script>
{% endblock %}
{% endblock %}